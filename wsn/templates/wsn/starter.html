<!--{% load static from staticfiles %} -->
{% load static %}
{% load geojson_tags %}

  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CenehaWSN  | Panel</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static "css/AdminLTE.min.css" %}">
    <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="{% static "css/skin-green-light.min.css" %}">
    <!-- datatables style -->
    <!-- <link rel="stylesheet" href="http://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css"> -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/rowreorder/1.2.0/css/rowReorder.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.4/css/buttons.dataTables.min.css">
    <!-- Boostrap style -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- leaflet style -->
	  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css">
	  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>


  </head>
  <body class="hold-transition skin-green-light sidebar-mini"> <!--layout-boxed-->
    <div class="wrapper">

      <header class="main-header">

        <!-- Logo -->
        <a href="{% url 'wsn:starter' %}" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini"><b></b>WSN</span>
          <!-- logo for regular state and mobile devices -->
          <span class="logo-lg"><b>Ceneha</b>WSN</span>
        </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
          <span class="sr-only">Toggle navigation</span>
        </a>
        <!-- Navbar Right Menu -->
        <div class="navbar-custom-menu">
          <ul class="nav navbar-nav">
            <!-- Messages: style can be found in dropdown.less-->
            <li class="dropdown messages-menu">
              <!-- Menu toggle button -->
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-flag-o"></i>
                  {% if bat %}
                  <span class="label label-danger">{{ bat|length }}</span>
                  {% else %}
                  <span class="label label-danger"></span>
                  {% endif %}
                </a>
                {% if bat %}
                {% for e in bat %}
                <ul class="dropdown-menu">
                  <li class="header">Notificaciones</li>
                  <li>
                    <!-- inner menu: contains the messages -->
                    <ul class="menu">
                      <li><!-- start message -->
                        <a href="#">
                          <div class="pull-left">
                            <!-- User Image -->
                            <img src="{% static "img/warning.png" %}" class="img-circle" alt="User Image">
                          </div>
                          <!-- Message title and timestamp -->
                          <h4>
                            <!-- {{ user.username }} --> <!-- colocar el usuario -->
                            {{ e.nodo }}
                            <small><i class="fa fa-clock-o"> </i> {{ e.fecha_hora.time }} <!-- poner directamente la hora del msj y listo--> </small>
                          </h4>
                          <!-- The message -->
                          <p>Batería baja - {{ e.fecha_hora.date }} </p>
                        </a>
                        {% endfor %}
                      </li>
                      <!-- end message -->
                    </ul>
                    <!-- /.menu -->
                  </li>
                  <!-- <li class="footer"><a href="#"> Ver todas las notificaciones</a></li> -->
                </ul>
              {% endif %}
            </li>
            <!-- User Account Menu -->
            <li class="dropdown user user-menu">
              <!-- Menu Toggle Button -->
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <!-- The user image in the navbar-->
                <!-- hidden-xs-down hides the username on small devices so only the image appears. -->
                <span class="hidden-xs-up"><i class="fa fa-gears"></i></span>
              </a>
              <ul class="dropdown-menu">
                <!-- The user image in the menu -->
                <li class="user-header">
                  {% if user.username == "ceneha" %}
                  <img src="{% static "img/ceneha.jpg" %}" class="img-circle" alt="User Image">
                  {% else %}
                  <img src="{% static "img/invite.png" %}" class="img-circle" alt="User Image">
                  {%endif%}
                  <p>
                    {{ user.username }} - Usuario
                    <small>Miembro desde Dic . 2016</small>
                  </p>
                </li>
                <!-- Menu Body -->
                <!--<li class="user-body">
                   <div class="row">
                  <div class="col-xs-4 text-center">
                  <a href="#">Followers</a>
                </div>
                <div class="col-xs-4 text-center">
                <a href="#">Sales</a>
              </div>
              <div class="col-xs-4 text-center">
              <a href="#">Friends</a>
            </div>
          </div> -->
          <!-- /.row -->
        <!--</li> -->
        <!-- Menu Footer-->
        <li class="user-footer">
          <!--<div class="pull-left">
          <a href="#" class="btn btn-default btn-flat">Perfil</a>
        </div> -->
        <div class="pull-right">
          <a href="{% url 'django.contrib.auth.views.logout' %}"  class="btn btn-default btn-flat">Cerrar sesión</a>
        </div>
      </li>
    </ul>
  </li>
  <!-- Control Sidebar Toggle Button -->
  <!-- <li>
      <a href="{% url 'django.contrib.auth.views.logout' %}" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
  </li> -->
  </ul>
  </div>
  </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">

    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel">
        <div class="pull-left image">
          {% if user.username == "ceneha" %}
          <img src="{% static "img/ceneha.jpg" %}" class="img-circle" alt="User Image">
          {% else %}
          <img src="{% static "img/invite.png" %}" class="img-circle" alt="User Image">
          {%endif%}
        </div>
        <div class="pull-left info">
          <p><font size="3"> {{ user.username }}</font></p>
          <!-- Status -->
          <!-- <a href="#"><i class="fa fa-circle text-success"></i> Online</a> -->
        </div>
      </div>
      <!-- search form (Optional) -->
      <!-- <form action="#" method="get" class="sidebar-form">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Search...">
          <span class="input-group-btn">
            <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
            </button>
          </span>
        </div>
      </form> -->
      <!-- /.search form -->
      <!-- Sidebar Menu -->
      <ul class="sidebar-menu">
        <li class="header"><font size="2.5"> Menu </font></li>
        <!-- Optionally, you can add icons to the links -->
        <li class="active"><a href="{%url 'wsn:lab' %}"><i class="fa fa-dashboard"></i><span>Pruebas de Laboratorio</span></a></li>
        <li><a href="{%url 'wsn:campo_uno' %}"><i class="fa fa-bar-chart"></i> <span>Pruebas de Campo N° 1</span></a></li>
        <li><a href="{%url 'wsn:campo_dos' %}"><i class="fa fa-pie-chart"></i> <span>Pruebas de Campo N° 2</span></a></li>
        <li><a href="{% url 'admin:index' %}"><i class="fa fa-edit"></i> <span>Administración</span></a></li>
      </ul>
      <!-- /.sidebar-menu -->
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        PFC
        <small>Prueba de laboratorio Nro. 1</small>
      </h1>
    </section>
    <!-- Main content -->
    <section class="content">
      <!-- Your Page Content Here -->
        <!-- MAPA -->
        <div class="box box-success">
          <div class="box-header with-border">
            <h3 class="box-title">Mapa</h3>

            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                <i class="fa fa-minus"></i></button>
            </div>
          </div>

          <div class="box-body">
            <div id="mymap" style="height: 440px; border: 1px solid #AAA;">
              <!-- cargo el mapa -->
              <script type="text/javascript">
                //Parametros: Satelite
                var satAttr = 'Power by Esri | Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
          		  satUrl = '//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
                ////Parametros: Calles
              	var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
              			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
              			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
              	mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

                var satelite = L.tileLayer(satUrl, {id: '', attribution: satAttr});
              	var streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

                //Inicializo el mapa con las conf. del sistema
              	var mymap = L.map('mymap', {
              		center: [-31.64075901725384, -60.67254424095153],
              		zoom: 14,
                  maxZoom: 17,
              		layers: [streets] //Pongo solo streets por que al iniciar es mas lento este
              	});

                var baseLayers = {
                  "Calles": streets,
                  "Satelite": satelite
                };

                //Agregar el baselayer es la ultima operacion. No se porq pero si pones los marcadores dsp no anda
                L.control.layers(baseLayers).addTo(mymap);

                //Cargo las locaciones de los nodos actuales
                var collection = {{locaciones|geojsonfeature:"popupContent"|safe }};

                function LocationsPlaces(feature, layer) {
                // does this feature have a property named popupContent?
                if (feature.properties && feature.properties.popupContent) {
                  layer.bindPopup(feature.properties.popupContent);
                  }
                }

                //muestro en el mapa los nodos
                var geojsonLayer = L.geoJSON(collection, {

                    onEachFeature: LocationsPlaces

                }).addTo(mymap);

               //centro el mapa sobre las locaciones cargadas
               mymap.fitBounds(geojsonLayer.getBounds().pad(0.5));

               </script>
            </div>
            <!-- /. mapa-->
          </div>
          <!-- /.box-body -->
        </div>
        <!--/. box-->
        <!-- Tension: Estado de las baterias del sistema -->
        <div class="box box-primary collapsed-box">
            <div class="box-header with-border">
              <h3 class="box-title">Nivel de batería</h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                  <i class="fa fa-plus"></i></button>
              </div>
            </div>
            <div class="box-body">
               <div id="bateria" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>
        </div>
        <!-- Tabla de datos del sistema -->
         <div class="box box-warning">
          <div class="box-header">
            <h3 class="box-title">Tabla de datos</h3>
          </div>
          <!-- /.box-header -->
           <div class="box-body">
            <table id="DataTable" class="table table-bordered table-striped responsive display no-wrap" width="100%" cellspacing="0">
              <thead>
              <tr>
                  <th>Nodo</th>
                  <th>Rol</th>
                  <th>Tipo_sensor</th>
                  <th>Sensor</th>
                  <th>Dato</th>
                  <th>Marca de tiempo</th>
              </tr>
              </thead>
              <!-- <tbody> </tbody> -->
              <tfoot>
              <tr>
                  <th>Nodo</th>
                  <th>Rol</th>
                  <th>Tipo_sensor</th>
                  <th>Sensor</th>
                  <th>Dato</th>
                  <th>Marca de tiempo</th>
              </tr>
              </tfoot>
            </table>
           </div>
          <!-- /.box-body -->
         </div>
        <!-- /.box -->
        <!-- grafica de temperatura global -->
        <div class="box box-info">
          <div class="box-header with-border">
            <h3 class="box-title">Gráficas - temperatura</h3>

            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                <i class="fa fa-minus"></i></button>
            </div>
          </div>
          <div class="box-body">
            <div id="temperatura_1" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
            <div id="temperatura_2" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
          </div>
        </div>
        <!-- grafica de humedad global -->
        <div class="box box-danger">
            <div class="box-header with-border">
              <h3 class="box-title">Gráficas - Humedad</h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                  <i class="fa fa-minus"></i></button>
              </div>
            </div>
            <div class="box-body">
              <div id="humedad" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>
          </div>
          <!-- grafica de nivel freatico global -->
          <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title">Gráficas - Presión atmosférica</h3>

                <div class="box-tools pull-right">
                  <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                    <i class="fa fa-minus"></i></button>
                </div>
              </div>
              <div class="box-body">
                 <div id="presion" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
              </div>
            </div>
            <div class="box box-success">
                <div class="box-header with-border">
                  <h3 class="box-title">Gráficas - Nivel freático</h3>

                  <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                      <i class="fa fa-minus"></i></button>
                  </div>
                </div>
                <div class="box-body">
                   <div id="freatico" width="100%" cellspacing="0"><!-- Plotly chart will be drawn inside this DIV --></div>
                </div>
              </div>
    <!-- /.content -->
        <!-- /.box -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="pull-right hidden-xs">
      PFC - Ing. Informática - FICH / UNL
    </div>
    <!-- Default to the left -->
    <strong> 2017 <a href="#">Renato J. Manzo</a>.</strong>
  </footer>

  <!-- Control Sidebar -->
  <!-- <aside class="control-sidebar control-sidebar-dark"> -->
    <!-- Create the tabs -->
     <!-- <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul> -->
    <!-- Tab panes -->
    <!--<div class="tab-content"> -->
      <!-- Home tab content -->
      <!--<div class="tab-pane active" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Recent Activity</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript::;">
              <i class="menu-icon fa fa-birthday-cake bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                <p>Will be 23 on April 24th</p>
              </div>
            </a>
          </li>
        </ul> -->
        <!-- /.control-sidebar-menu -->

        <!-- <h3 class="control-sidebar-heading">Tasks Progress</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript::;">
              <h4 class="control-sidebar-subheading">
                Custom Template Design
                <span class="pull-right-container">
                  <span class="label label-danger pull-right">70%</span>
                </span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
              </div>
            </a>
          </li>
        </ul> -->
        <!-- /.control-sidebar-menu -->
      <!-- </div> -->
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <!-- <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div> -->
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <!-- <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">Administración general</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Panel de reporte
              <input type="checkbox" class="pull-right" checked>
            </label>
            <p>
              Información
            </p>
          </div> -->
          <!-- /.form-group -->
        <!-- </form>
      </div> -->
      <!-- /.tab-pane -->
    <!--</div>
  </aside> -->
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <!-- <div class="control-sidebar-bg"></div>
  </div> -->
  <!-- ./wrapper -->
  <!-- REQUIRED JS SCRIPTS -->
  <!-- jQuery 2.2.3 -->
  <script src="{% static "js/jquery-2.2.3.min.js"%}"></script>
  <!-- Bootstrap 3.3.6 -->
  <script src="{% static "js/bootstrap.min.js" %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static "js/app.min.js" %}"></script>
  <!-- dataTables Js -->
  <!-- <script src="{% static "js/dataTables.bootstrap.min.js" %}"></script>
  <script src="{% static "js/jquery.dataTables.min.js" %}"></script> -->
  <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
  <script src="https://cdn.datatables.net/rowreorder/1.2.0/js/dataTables.rowReorder.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.1.1/js/dataTables.responsive.min.js "></script>
  <script src="https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
  <script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.2.4/js/buttons.html5.min.js"></script>
  <!-- datatables Js serverSide -->
  <!-- <script src="{% static "js/datostabla.js" %}"></script> -->
  <!-- Plot.ly JS -->
  <script src="{% static "js/plotly-latest.min.js" %}"></script>

  <!-- datatables Js -->
  <script type="text/javascript">
      //Ajax url path
      var TABLA_LIST_JSON_URL = "{% url 'wsn:api_table_lab' %}";
      //Configuraciones datatable
      $(document).ready(function() {
        var table = $('#DataTable').DataTable({
              "language": language_d,  // global variable defined in html
              "ordering": [[1 , "asc" ]],
              "dom": '<"floaRight"B><"clear">rlftip',
                  buttons: ['csvHtml5','pdfHtml5'],
              "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, 'All']],
              "searching": true,
              "processing": true,
              "serverSide": true,
              "stateSave": true,
              "legacyAjax": true,
              "ajax": TABLA_LIST_JSON_URL,
              responsive: true,
          });
      });
      // languague display options
      var language_d = {
        "lengthMenu": "Mostrar _MENU_ filas por página ",
        "zeroRecords": "No se encontro nada",
        "info": "Mostrando página _PAGE_ de _PAGES_",
        "infoEmpty": "Sin información disponible",
        "infoFiltered": "(Filtrando unas _MAX_ lineas)",
        "search": "Filtro:",
        "loadingRecords": "Cargando...",
        "processing": "Procesando...",
        "paginate": {
          "first":      "Primera",
          "last":       "Última",
          "next":       "Siguiente",
          "previous":   "Anterior"
          },
      };
  </script>
  <!-- JS - Temperatura_1 -->
  <script type="text/javascript">

  Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
    //aux arrays
    var x_data_node1 = [],
        x_data_node2 = [],
        x_data_node3 = [],
        x_data_node4 = [];

    var y_data_node1 = [],
        y_data_node2 = [],
        y_data_node3 = [],
        y_data_node4 = [];

    //asigno a las variables los datos de los nodos
    for (i = 0; i < dat_fig.length; i++) {
      if(dat_fig[i].filtro == "Nodo_1_Temperatura_DHT22")
        x_data_node1.push(dat_fig[i].timestamp);
        y_data_node1.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_2_Temperatura_DHT22")
        x_data_node2.push(dat_fig[i].timestamp);
        y_data_node2.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_3_Temperatura_DHT22")
        x_data_node3.push(dat_fig[i].timestamp);
        y_data_node3.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_4_Temperatura_DHT22")
        x_data_node4.push(dat_fig[i].timestamp);
        y_data_node4.push(dat_fig[i].data);
    }

    if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {

      var node1_data = {
          x: x_data_node1,
          y: y_data_node1,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_1'
      };
      var node2_data = {
          x: x_data_node2,
          y: y_data_node2,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_2'
      };
      var node3_data = {
          x: x_data_node3,
          y: y_data_node3,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_3'
      };
      var node4_data = {
          x: x_data_node4,
          y: y_data_node4,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_4'
      };

        //seteo el tipo de variable del selector
        var xField = 'Date';
        var yField = 'Humedad';

        //genero el selector para filtrar los datos (todos backward)
        var selectorOptions = {
            buttons: [{
                step: 'day',
                stepmode: 'backward',
                count: 1,
                label: 'Día'
            }, {
                step: 'day',
                stepmode: 'backward',
                count: 7,
                label: 'Semana'
            }, {
                step: 'all',
            }],
        };

        //Creo una variable global de datos
        var data = [node1_data,node2_data,node3_data,node4_data];

        //Finalmente creo la grafica
        var gr = Plotly.plot('temperatura_1', data , {
          title:'DHT22',
          xaxis: {title: 'Tiempo',
                  rangeselector: selectorOptions,
                  //rangeslider: {}
                },
          yaxis: {title: 'Temperatura (°C)',
                  type: 'log',
                  fixedrange: true},
          margin: {t: 20},
          autosize: true,
          });
        }
      });

    $(window).resize(function() {
     var divheight = $("#temperatura_1").height();
     var divwidth = $("#temperatura_1").width();

     var update = {
              width:divwidth,  // or any new width
              height:divheight // " "
            };

    Plotly.relayout('temperatura_1', update);
            }).resize();

  </script>
  <!-- JS - Temperatura_2 -->
  <script type="text/javascript">

  Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
    //aux arrays
    var x_data_node1 = [],
        x_data_node2 = [],
        x_data_node3 = [],
        x_data_node4 = [];

    var y_data_node1 = [],
        y_data_node2 = [],
        y_data_node3 = [],
        y_data_node4 = [];

    //asigno a las variables los datos de los nodos
    for (i = 0; i < dat_fig.length; i++) {
      if(dat_fig[i].filtro == "Nodo_1_Temperatura_MCP9808")
        x_data_node1.push(dat_fig[i].timestamp);
        y_data_node1.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_2_Temperatura_MCP9808")
        x_data_node2.push(dat_fig[i].timestamp);
        y_data_node2.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_3_Temperatura_MCP9808")
        x_data_node3.push(dat_fig[i].timestamp);
        y_data_node3.push(dat_fig[i].data);
      if(dat_fig[i].filtro == "Nodo_4_Temperatura_MCP9808")
        x_data_node4.push(dat_fig[i].timestamp);
        y_data_node4.push(dat_fig[i].data);
    }

    if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {

      var node1_data = {
          x: x_data_node1,
          y: y_data_node1,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_1'
      };
      var node2_data = {
          x: x_data_node2,
          y: y_data_node2,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_2'
      };
      var node3_data = {
          x: x_data_node3,
          y: y_data_node3,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_3'
      };
      var node4_data = {
          x: x_data_node4,
          y: y_data_node4,
          type: 'scatter',
          line: {shape: 'spline'},
          name: 'Nodo_4'
      };

        //seteo el tipo de variable del selector
        var xField = 'Date';
        var yField = 'Humedad';

        //genero el selector para filtrar los datos (todos backward)
        var selectorOptions = {
            buttons: [{
                step: 'day',
                stepmode: 'backward',
                count: 1,
                label: 'Día'
            }, {
                step: 'day',
                stepmode: 'backward',
                count: 7,
                label: 'Semana'
            }, {
                step: 'all',
            }],
        };

        //Creo una variable global de datos
        var data = [node1_data,node2_data,node3_data,node4_data];

        //Finalmente creo la grafica
        var gr = Plotly.plot('temperatura_2', data , {
          title:'MCP9808',
          xaxis: {title: 'Tiempo',
                  rangeselector: selectorOptions,
                  //rangeslider: {}
                },
          yaxis: {title: 'Temperatura (°C)',
                  type: 'log',
                  fixedrange: true},
          margin: {t: 20},
          autosize: true,
          });
        }
    });

    $(window).resize(function() {
     var divheight = $("#temperatura_2").height();
     var divwidth = $("#temperatura_2").width();

     var update = {
              width:divwidth,  // or any new width
              height:divheight // " "
            };

    Plotly.relayout('temperatura_2', update);
            }).resize();

  </script>
  <!-- JS - Humedad -->
    <script type="text/javascript">

    Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
      //aux arrays
      var x_data_node1 = [],
          x_data_node2 = [],
          x_data_node3 = [],
          x_data_node4 = [];

      var y_data_node1 = [],
          y_data_node2 = [],
          y_data_node3 = [],
          y_data_node4 = [];

      //asigno a las variables los datos de los nodos
      for (i = 0; i < dat_fig.length; i++) {
        if(dat_fig[i].filtro == "Nodo_1_Humedad_DHT22")
          x_data_node1.push(dat_fig[i].timestamp);
          y_data_node1.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_2_Humedad_DHT22")
          x_data_node2.push(dat_fig[i].timestamp);
          y_data_node2.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_3_Humedad_DHT22")
          x_data_node3.push(dat_fig[i].timestamp);
          y_data_node3.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_4_Humedad_DHT22")
          x_data_node4.push(dat_fig[i].timestamp);
          y_data_node4.push(dat_fig[i].data);
      }

      if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {

        //Cargo las variables de cada nodo con la información de X e Y
        var node1_data = {
            x: x_data_node1,
            y: y_data_node1,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_1'
        };
        var node2_data = {
            x: x_data_node2,
            y: y_data_node2,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_2'
        };
        var node3_data = {
            x: x_data_node3,
            y: y_data_node3,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_3'
        };
        var node4_data = {
            x: x_data_node4,
            y: y_data_node4,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_4'
        };

        //seteo el tipo de variable del selector
        var xField = 'Date';
        var yField = 'Humedad';

        //genero el selector para filtrar los datos (todos backward)
        var selectorOptions = {
            buttons: [{
                step: 'day',
                stepmode: 'backward',
                count: 1,
                label: 'Día'
            }, {
                step: 'day',
                stepmode: 'backward',
                count: 7,
                label: 'Semana'
            }, {
                step: 'all',
            }],
        };

        //Creo una variable global de datos
        var data = [node1_data,node2_data,node3_data,node4_data];

        //Finalmente creo la grafica
        Plotly.plot('humedad', data , {
          title:'DHT22',
          xaxis: {title: 'Tiempo',
                  rangeselector: selectorOptions,
                  //rangeslider: {}
                },
          yaxis: {title: 'Humedad (%)',
                  type: 'log',
                  fixedrange: true},
          margin: {t: 20},
          autosize: true,
          font: {size: 14},
          });
        } //endif
    });

    //window.onresize = function() {
    //  Plotly.Plots.resize('humedad');
    //};

    $(window).resize(function() {
     var divheight = $("#humedad").height();
     var divwidth = $("#humedad").width();

     var update = {
              width:divwidth,  // or any new width
              height:divheight // " "
            };

    Plotly.relayout('humedad', update);
        }).resize();

    </script>
    <!-- JS - presion atmosferica -->
    <script type="text/javascript">

    Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
      //aux arrays
      var x_data_node1 = [],
          x_data_node2 = [],
          x_data_node3 = [],
          x_data_node4 = [];

      var y_data_node1 = [],
          y_data_node2 = [],
          y_data_node3 = [],
          y_data_node4 = [];

      //asigno a las variables los datos de los nodos
      for (i = 0; i < dat_fig.length; i++) {
        if(dat_fig[i].filtro == "Nodo_1_Presión_atmosferica_BMP183")
          x_data_node1.push(dat_fig[i].timestamp);
          y_data_node1.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_2_Presión_atmosferica_BMP183")
          x_data_node2.push(dat_fig[i].timestamp);
          y_data_node2.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_3_Presión_atmosferica_BMP183")
          x_data_node3.push(dat_fig[i].timestamp);
          y_data_node3.push(dat_fig[i].data);
        if(dat_fig[i].filtro == "Nodo_4_Presión_atmosferica_BMP183")
          x_data_node4.push(dat_fig[i].timestamp);
          y_data_node4.push(dat_fig[i].data);
      }

      if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {
        var node1_data = {
            x: x_data_node1,
            y: y_data_node1,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_1'
        };
        var node2_data = {
            x: x_data_node2,
            y: y_data_node2,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_2'
        };
        var node3_data = {
            x: x_data_node3,
            y: y_data_node3,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_3'
        };
        var node4_data = {
            x: x_data_node4,
            y: y_data_node4,
            type: 'scatter',
            line: {shape: 'spline'},
            name: 'Nodo_4'
        };

          //seteo el tipo de variable del selector
          var xField = 'Date';
          var yField = 'Presión';

          //genero el selector para filtrar los datos (todos backward)
          var selectorOptions = {
              buttons: [{
                  step: 'day',
                  stepmode: 'backward',
                  count: 1,
                  label: 'Día'
              }, {
                  step: 'day',
                  stepmode: 'backward',
                  count: 7,
                  label: 'Semana'
              }, {
                  step: 'all',
              }],
          };

          //Creo una variable global de datos
          var data = [node1_data,node2_data,node3_data,node4_data];

          //Finalmente creo la grafica
          var gr = Plotly.plot('presion', data , {
            title:'BMP138',
            xaxis: {title: 'Tiempo',
                    rangeselector: selectorOptions,
                    //rangeslider: {}
                  },
            yaxis: {title: 'Presión (Pa)',
                    type: 'log',
                    fixedrange: true},
            margin: {t: 20},
            autosize: true,
            font: {size: 14},
            });
          } //endif
        });

        $(window).resize(function() {
         var divheight = $("#presion").height();
         var divwidth = $("#presion").width();

         var update = {
                  width:divwidth,  // or any new width
                  height:divheight // " "
                };

        Plotly.relayout('presion', update);
                }).resize();

    </script>

        <script type="text/javascript">

        Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
          //aux arrays
          var x_data_node1 = [],
              x_data_node2 = [],
              x_data_node3 = [],
              x_data_node4 = [];

          var y_data_node1 = [],
              y_data_node2 = [],
              y_data_node3 = [],
              y_data_node4 = [];

          //asigno a las variables los datos de los nodos
          for (i = 0; i < dat_fig.length; i++) {
            if(dat_fig[i].filtro == "Nodo_1_Distancia_GP2Y0A710K0F")
              x_data_node1.push(dat_fig[i].timestamp);
              y_data_node1.push(dat_fig[i].data);
            if(dat_fig[i].filtro == "Nodo_2_Distancia_GP2Y0A710K0F")
              x_data_node2.push(dat_fig[i].timestamp);
              y_data_node2.push(dat_fig[i].data);
            if(dat_fig[i].filtro == "Nodo_3_Distancia_GP2Y0A710K0F")
              x_data_node3.push(dat_fig[i].timestamp);
              y_data_node3.push(dat_fig[i].data);
            if(dat_fig[i].filtro == "Nodo_4_Distancia_GP2Y0A710K0F")
              x_data_node4.push(dat_fig[i].timestamp);
              y_data_node4.push(dat_fig[i].data);
          }

          if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {
            var node1_data = {
                x: x_data_node1,
                y: y_data_node1,
                type: 'scatter',
                line: {shape: 'spline'},
                name: 'Nodo_1'
            };
            var node2_data = {
                x: x_data_node2,
                y: y_data_node2,
                type: 'scatter',
                line: {shape: 'spline'},
                name: 'Nodo_2'
            };
            var node3_data = {
                x: x_data_node3,
                y: y_data_node3,
                type: 'scatter',
                line: {shape: 'spline'},
                name: 'Nodo_3'
            };
            var node4_data = {
                x: x_data_node4,
                y: y_data_node4,
                type: 'scatter',
                line: {shape: 'spline'},
                name: 'Nodo_4'
            };

              //seteo el tipo de variable del selector
              var xField = 'Date';
              var yField = 'Nivel';

              //genero el selector para filtrar los datos (todos backward)
              var selectorOptions = {
                  buttons: [{
                      step: 'day',
                      stepmode: 'backward',
                      count: 1,
                      label: 'Día'
                  }, {
                      step: 'day',
                      stepmode: 'backward',
                      count: 7,
                      label: 'Semana'
                  }, {
                      step: 'all',
                  }],
              };

              //Creo una variable global de datos
              var data = [node1_data,node2_data,node3_data,node4_data];

              //Finalmente creo la grafica
              var gr = Plotly.plot('freatico', data , {
                title:'GP2Y0A710K0F',
                xaxis: {title: 'Tiempo',
                        rangeselector: selectorOptions,
                        //rangeslider: {}
                      },
                yaxis: {title: 'Nivel (Mts)',
                        type: 'log',
                        fixedrange: true},
                margin: {t: 20},
                autosize: true,
                font: {size: 14},
                });
              } //endif
            });

            $(window).resize(function() {
             var divheight = $("#freatico").height();
             var divwidth = $("#freatico").width();

             var update = {
                      width:divwidth,  // or any new width
                      height:divheight // " "
                    };

            Plotly.relayout('freatico', update);

                }).resize();


        </script>

      <!-- JS - presion atmosferica -->
      <script type="text/javascript">

      Plotly.d3.json('{% url 'wsn:api_graph_lab' %}', function(dat_fig){
        //aux arrays
        var x_data_node1 = [],
            x_data_node2 = [],
            x_data_node3 = [],
            x_data_node4 = [];

        var y_data_node1 = [],
            y_data_node2 = [],
            y_data_node3 = [],
            y_data_node4 = [];

        //asigno a las variables los datos de los nodos
        for (i = 0; i < dat_fig.length; i++) {
          if(dat_fig[i].filtro == "Nodo_1_Batería_Tensión")
            x_data_node1.push(dat_fig[i].timestamp);
            y_data_node1.push(dat_fig[i].data);
          if(dat_fig[i].filtro == "Nodo_2_Batería_Tensión")
            x_data_node2.push(dat_fig[i].timestamp);
            y_data_node2.push(dat_fig[i].data);
          if(dat_fig[i].filtro == "Nodo_3_Batería_Tensión")
            x_data_node3.push(dat_fig[i].timestamp);
            y_data_node3.push(dat_fig[i].data);
          if(dat_fig[i].filtro == "Nodo_4_Batería_Tensión")
            x_data_node4.push(dat_fig[i].timestamp);
            y_data_node4.push(dat_fig[i].data);
        }

        if (x_data_node1[0] != null || x_data_node2[0] != null || x_data_node3[0] != null || x_data_node4[0] != null)  {
          var node1_data = {
              x: x_data_node1,
              y: y_data_node1,
              type: 'scatter',
              line: {shape: 'spline'},
              name: 'Nodo_1'
          };
          var node2_data = {
              x: x_data_node2,
              y: y_data_node2,
              type: 'scatter',
              line: {shape: 'spline'},
              name: 'Nodo_2'
          };
          var node3_data = {
              x: x_data_node3,
              y: y_data_node3,
              type: 'scatter',
              line: {shape: 'spline'},
              name: 'Nodo_3'
          };
          var node4_data = {
              x: x_data_node4,
              y: y_data_node4,
              type: 'scatter',
              line: {shape: 'spline'},
              name: 'Nodo_4'
          };

            //seteo el tipo de variable del selector
            var xField = 'Date';
            var yField = 'Tensión';

            //genero el selector para filtrar los datos (todos backward)
            var selectorOptions = {
                buttons: [{
                    step: 'day',
                    stepmode: 'backward',
                    count: 1,
                    label: 'Día'
                }, {
                    step: 'day',
                    stepmode: 'backward',
                    count: 7,
                    label: 'Semana'
                }, {
                    step: 'all',
                }],
            };

            //Creo una variable global de datos
            var data = [node1_data,node2_data,node3_data,node4_data];

            //Finalmente creo la grafica
            var gr = Plotly.plot('bateria', data , {
              xaxis: {title: 'Tiempo',
                      rangeselector: selectorOptions,
                      //rangeslider: {}
                    },
              yaxis: {title: 'Tensión (V)',
                      type: 'log',
                      fixedrange: true},
              margin: {t: 20},
              font: {size: 14},
              } );
            } //endif
          });

        $(window).resize(function() {
         var divheight = $("#bateria").height();
         var divwidth = $("#bateria").width();

         var update = {
                  width:divwidth,  // or any new width
                  height:divheight // " "
                };

        Plotly.relayout('bateria', update);

            }).resize();

      </script>

  </body>
  </html>
